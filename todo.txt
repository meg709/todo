# 1. Load the PublicUser's Registry Hive
reg load HKU\TempPublic "C:\Users\PublicUser\NTUSER.DAT"

# 2. Clean and Create ALL Policy Keys
# We delete the blocklist and create our own new, clean policy keys
reg delete "HKU\TempPublic\Software\Policies\Microsoft\Edge" /f /v /va 2>$null
reg add "HKU\TempPublic\Software\Policies\Microsoft\Edge" /f
reg add "HKU\TempPublic\Software\Policies\Microsoft\Edge\URLAllowlist" /f
reg add "HKU\TempPublic\Software\Policies\Microsoft\Edge\URLBlocklist" /f

# 3. The Block Rule (Blocking Everything)
reg add "HKU\TempPublic\Software\Policies\Microsoft\Edge\URLBlocklist" /v 1 /t REG_SZ /d "*" /f

# 4. The URL Allow List (NYP + CDNs) - These need to run last to win precedence
reg add "HKU\TempPublic\Software\Policies\Microsoft\Edge\URLAllowlist" /v 1 /t REG_SZ /d "https://library.nyp.edu.sg/*" /f
reg add "HKU\TempPublic\Software\Policies\Microsoft\Edge\URLAllowlist" /v 2 /t REG_SZ /d "https://www.nyp.edu.sg/*" /f
reg add "HKU\TempPublic\Software\Policies\Microsoft\Edge\URLAllowlist" /v 3 /t REG_SZ /d "https://cdnjs.cloudflare.com/*" /f

# 5. Unload the Registry Hive
reg unload HKU\TempPublic
