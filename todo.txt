# === ONLY CHANGE THIS ONE LINE ===
$KioskSID = "S-1-5-21-XXXXXXXXXXXXXXXXXXXXXXXXXXXX-XXXX"   # ‚Üê paste your SID here inside the quotes
# =================================

$Allowed1 = "https://library.nyp.edu.sg/*"
$Allowed2 = "https://www.nyp.edu.sg/*"

$regPath = "$KioskSID\Software\Policies\Microsoft\Edge"

# Load the user's registry hive (kioskUser0 is probably logged off, so we mount it)
New-PSDrive -Name HKU -PSProvider Registry -Root HKEY_USERS -ErrorAction SilentlyContinue | Out-Null

if (!(Test-Path "HKU:\$KioskSID")) {
    reg load "HKU\$KioskSID" "C:\Users\kioskUser0\NTUSER.DAT" | Out-Null
    $unmount = $true
}

# Create the policy keys
New-Item -Path "HKU:\$regPath\URLAllowlist" -Force | Out-Null
New-Item -Path "HKU:\$regPath\URLBlocklist" -Force | Out-Null

# Allow only the two NYP sites
Set-ItemProperty -Path "HKU:\$regPath\URLAllowlist" -Name "1" -Value $Allowed1
Set-ItemProperty -Path "HKU:\$regPath\URLAllowlist" -Name "2" -Value $Allowed2

# Block EVERYTHING else
Set-ItemProperty -Path "HKU:\$regPath\URLBlocklist" -Name "1" -Value "*"

Write-Host "SUCCESS! Only the two NYP sites are allowed for kioskUser0 now." -ForegroundColor Green

# Cleanly unload the hive if we mounted
if ($unmount) { 
    Start-Sleep -Seconds 2
    reg unload "HKU\$KioskSID" | Out-Null 
}
