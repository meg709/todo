# 1. Clean old crap to start fresh (no errors if missing)
Remove-Item "HKLM:\SOFTWARE\Policies\Microsoft\Edge" -Recurse -Force -ErrorAction SilentlyContinue
New-Item -Path "HKLM:\SOFTWARE\Policies\Microsoft\Edge" -Force | Out-Null

# 2. Core kiosk policies (using New-ItemProperty to dodge the empty Name param bug)
New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Edge" -Name "KioskModeEnabled" -Value 1 -PropertyType DWord -Force | Out-Null
New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Edge" -Name "HideInternetExplorerRedirectUX" -Value 1 -PropertyType DWord -Force | Out-Null
New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Edge" -Name "AlwaysOpenPdfExternally" -Value 0 -PropertyType DWord -Force | Out-Null

# 3. Force startup with ONLY your two NYP sites (MultiString array â€“ this is the lock-in magic)
$sites = @("https://library.nyp.edu.sg/", "https://www.nyp.edu.sg/")
New-Item -Path "HKLM:\SOFTWARE\Policies\Microsoft\Edge" -Name "RestoreOnStartupURLs" -Force | Out-Null
New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Edge" -Name "RestoreOnStartupURLs" -Value $sites -PropertyType MultiString -Force | Out-Null
New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Edge" -Name "RestoreOnStartup" -Value 4 -PropertyType DWord -Force | Out-Null

# 4. Lock down the UI (no address bar, no home button, new tabs redirect to your site)
New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Edge" -Name "ShowHomeButton" -Value 0 -PropertyType DWord -Force | Out-Null
New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Edge" -Name "NewTabPageLocation" -Value "https://library.nyp.edu.sg/" -PropertyType String -Force | Out-Null

Write-Host "SUCCESS! Policies set without errors. Reboot now to test kioskUser0." -ForegroundColor Green
